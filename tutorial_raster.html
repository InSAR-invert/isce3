<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ISCE: Raster Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ISCE
   &#160;<span id="projectnumber">3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="sphinx/html/index.html"><span>Python&#160;classes</span></a></li>
      <li><a href="https://github-fn.jpl.nasa.gov/isce-3/isce/issues/"><span>Issue&#160;Tracker</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Raster Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rasterinclude">Include headers</a></li>
<li class="level1"><a href="#rasterconstruct">Constructors</a><ul><li class="level2"><a href="#rasterreadonly">Read-Only Mode</a></li>
<li class="level2"><a href="#rasterupdate">Update Mode</a></li>
<li class="level2"><a href="#rastercreatetut">Create new rasters</a></li>
</ul>
</li>
<li class="level1"><a href="#hdf5io">Working with HDF5 files</a><ul><li class="level2"><a href="#ih5intro">IH5 - Extension of H5 C++ interface</a></li>
<li class="level2"><a href="#ih52raster">Passing HDF5 datasets to Raster interface</a></li>
</ul>
</li>
<li class="level1"><a href="#rasterpixel">Reading/Writing Single Pixel</a></li>
<li class="level1"><a href="#rasterline">Reading/Writing Single line</a></li>
<li class="level1"><a href="#rasterblock">Reading/Writing Single block</a></li>
<li class="level1"><a href="#rasteradvanced">Advanced usage - direct access to GDAL dataset</a></li>
</ul>
</div>
<div class="textblock"><p>ISCE delegates raster data handling to the Geospatial Data Abstraction Library (<a href="https://www.gdal.org">GDAL</a>). Hence, it uses all the conventions defined by the <a href="http://www.gdal.org/gdal_datamodel.html">GDAL data model</a> to simplify the interface. You will find detailed documentation of all the methods available here: isce3::io::Raster.</p>
<h1><a class="anchor" id="rasterinclude"></a>
Include headers</h1>
<p>In general, one only needs to include the isce3::io::Raster headerfile. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;isce3/io/Raster.h&quot;</span></div>
</div><!-- fragment --><p>If one is looking to create Rasters as part of your workflow, include appropriate the main GDAL header file. This will provide access to pre-defined data types and enum variables. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;gdal.h&quot;</span></div>
</div><!-- fragment --><p>If one is looking to use advanecd features from GDAL, you might need additional appropriate header files.</p>
<h1><a class="anchor" id="rasterconstruct"></a>
Constructors</h1>
<h2><a class="anchor" id="rasterreadonly"></a>
Read-Only Mode</h2>
<p>Raster imagery that already exists can be opened in Read-Only mode in a simple manner with just a string with the filename to be used.</p>
<div class="fragment"><div class="line">isce3::io::Raster raster(inputFilename);</div>
</div><!-- fragment --><p>All the GDAL environment variables and driver settings are respected. One should also be able to access remotely located resources using vsicurl / vsis3 etc. One can also use standard GDAL interfaces to access raster imagery within NETCDF and HDF5 by treating them as subdatasets (see here for details on <a href="https://www.gdal.org/frmt_netcdf.html">NETCDF</a> and <a href="https://www.gdal.org/frmt_hdf5.html">HDF5</a>). For a complete list of supported formats in your GDAL build , refer to output of</p>
<div class="fragment"><div class="line">&gt; gdalinfo --formats</div>
</div><!-- fragment --><h2><a class="anchor" id="rasterupdate"></a>
Update Mode</h2>
<p>An existing GDAL-compatible raster can be opened in Update mode in ISCE as follows </p>
<div class="fragment"><div class="line"><span class="comment">//Will need to include gdal.h for definition of GA_Update</span></div>
<div class="line">isce3::io::Raster raster(inputFilename, GA_Update)</div>
</div><!-- fragment --><h2><a class="anchor" id="rastercreatetut"></a>
Create new rasters</h2>
<p>The most general interface to creation of rasters is exposed via isce3::io::Raster(const std::string&amp; fname, size_t width, size_t length, size_t numBands, GDALDataType dtype, const std::string&amp; driverName).</p>
<ol>
<li>
If numBands is not provided, it is assumed that user wants to create a single band raster. </li>
<li>
If no dtype is provided, it is assumed that user wants to work with isce3::io::defaultGDALDataType. </li>
<li>
If no driverName is provided, it is assumed that user wants to work with isce3::io::defaultGDALDriver. </li>
</ol>
<p>See the full range of isce3::io::Raster constructors available for options. Note that you will need to include gdal.h to use GDAL type definitions.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Add ability to pass creation options to Raster object. This could possibly be done by accepting a vector of strings as an additional input, that is then passed directly to the GDAL driver during creation.</dd></dl>
<h1><a class="anchor" id="hdf5io"></a>
Working with HDF5 files</h1>
<p>NISAR mission will produce Level 1 and Level 2 products in HDF5 format. However, GDAL does not include HDF5 creation support. ISCE provides two different interfaces to work with HDF5 files. Since, GDAL does not include HDF5 creation support</p>
<ul>
<li>users are expected to use the IH5 interface described below or h5py at the Python level for dataset creation, and then wire it through a custom IH5 GDAL Driver for I/O.</li>
</ul>
<h2><a class="anchor" id="ih5intro"></a>
IH5 - Extension of H5 C++ interface</h2>
<p>ISCE includes an easy to use HDF5 interface using isce3::io namespace, that can be used to create/ manipulate HDF5 groups and datasets. The documentation for the following classes are useful to understand HDF5 manipulation at the C++ level: </p>
<ul>
<li>
isce3::io::IH5File - Extension of <a href="https://support.hdfgroup.org/HDF5/doc/cpplus_RM/class_h5_1_1_h5_file.html">H5::H5File</a> with simpler interfaces </li>
<li>
isce3::io::IDataSet - Extension of <a href="https://support.hdfgroup.org/HDF5/doc/cpplus_RM/class_h5_1_1_data_set.html">H5::H5DataSet</a> with simpler interfaces </li>
<li>
isce3::io::IGroup - Extension of <a href="https://support.hdfgroup.org/HDF5/doc/cpplus_RM/class_h5_1_1_group.html">H5::H5Group</a> with simpler interfaces </li>
</ul>
<div class="fragment"><div class="line"><span class="comment">//This provides access to our extensions of H5 C++</span></div>
<div class="line"><span class="preprocessor">#include &quot;isce3/io/IH5Dataset.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Create a HDF5 file in write mode</span></div>
<div class="line">std::string filename = <span class="stringliteral">&quot;example.h5&quot;</span>;</div>
<div class="line">isce3::io::IH5File(filename, <span class="charliteral">&#39;w&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Create a group inside the file</span></div>
<div class="line"><span class="comment">//Set groupname to &quot;/&quot; for root</span></div>
<div class="line">std::string groupname = <span class="stringliteral">&quot;level1/level2&quot;</span>;</div>
<div class="line">isce3::io::IGroup grp = fid.createGroup(groupname);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Create a dataset inside the group</span></div>
<div class="line">std::string dsetname = <span class="stringliteral">&quot;data&quot;</span>;</div>
<div class="line">std::array&lt;int, 2&gt; shape = {100, 200}; <span class="comment">//{length, width}</span></div>
<div class="line">isce3::io::IDataSet dset = grp.createDataSet&lt;<span class="keywordtype">float</span>&gt;(dsetname, shape); <span class="comment">//Simple dataset</span></div>
</div><!-- fragment --><p>The IH5 classes are extensively documented and we refer users to browse the documentation for alternate interfaces that might suit their use case. In general, the following set of rules are useful to remember:</p>
<ol>
<li>
Use isce3::io::IH5File::createGroup to create new groups and isce3::io::IH5File::openGroup to access existing groups. </li>
<li>
Use isce3::io::IGroup::createDataSet to create new groups and isce3::io::IH5File::openDataSet / isce3::io::IGroup::openDataSet to access existing datasets. </li>
<li>
There are numerous interfaces to creating HDF5 datasets - all overloaded under isce3::io::IH5File::createDataset. Please spend some time on choosing the right interface for your implementation. </li>
<li>
IEEE float16 data types are available under isce3::io::float16 and these can be used with IH5 interfaces to create datasets. Note that this type is not available for computation. Any I/O operation transforms data stored in isce3::io::float16 or std::complex&lt;isce3::io::float16&gt; this to user requested native type. </li>
<li>
isce3::io::IDataSet::read and isce3::io::IDataSet::write methods can then be used to read / write to datasets. </li>
<li>
isce3::io::IDataSet::createAttribute or isce3::io::IGroup::createAttribute can be used to create attributes. </li>
<li>
isce3::io::IDataSet::read or isce3::io::IGroup::read have been overloaded to read attributes. </li>
</ol>
<h2><a class="anchor" id="ih52raster"></a>
Passing HDF5 datasets to Raster interface</h2>
<p>Once access to HDF5 datasets has been setup using the IH5 interface discussed above, users can create an isce3::io::Raster object from it as shown below:</p>
<div class="fragment"><div class="line"><span class="comment">//Header file for the GDAL interface</span></div>
<div class="line"><span class="preprocessor">#include &quot;isce3/io/IH5Dataset.h&quot;</span>  </div>
<div class="line"></div>
<div class="line"><span class="comment">//Register custom IH5 Driver</span></div>
<div class="line">GDALAllRegister();</div>
<div class="line">isce3::io::GDALRegister_IH5();</div>
<div class="line"></div>
<div class="line"><span class="comment">//Open HDF5 file for reading</span></div>
<div class="line">isce3::io::IH5File file(<span class="stringliteral">&quot;NISAR_SLC.h5&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Access dataset</span></div>
<div class="line">isce3::io::IDataSet dset = file.openDataSet(<span class="stringliteral">&quot;/science/LSAR/SLC/swaths/frequencyA/HH&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Pass on to raster</span></div>
<div class="line">isce3::io::Raster slc( dset.toGDAL(), GA_ReadOnly);</div>
</div><!-- fragment --><p>Rasters created using IH5 interface are equivalent to any other GDAL Dataset and same interface can be used to populate / read data from these Rasters. isce3::io::IDataSet::toGDAL generates a string that is interpreted by GDAL's custom IH5 driver, in a manner very similar to GDAL's inbuilt <a href="https://gdal.org/drivers/raster/mem.html">MEM driver</a>.</p>
<h1><a class="anchor" id="rasterpixel"></a>
Reading/Writing Single Pixel</h1>
<p>Note that all pixels are indexed by the Top-Left corner (see <a href="overview_raster.html">Raster Overview</a>). One can read the data into a buffer of a type different from the storage format, as GDAL will handle the type translation.</p>
<p>We use isce3::io::Raster::getValue to read a pixel value from Band 2 of the raster image in this example. If band number is not provided, it is assumed to be 1.</p>
<div class="fragment"><div class="line"><span class="comment">//Open existing tiff file</span></div>
<div class="line">isce3::io::Raster raster(<span class="stringliteral">&quot;test.tif&quot;</span>);</div>
<div class="line"><span class="keywordtype">double</span> val;</div>
<div class="line"></div>
<div class="line"><span class="comment">//Get value from Band 2</span></div>
<div class="line">raster.getValue(val, 5, 10, 2);</div>
<div class="line"></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Image dimensions: &quot;</span> &lt;&lt; raster.width() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; raster.length() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Value at 5P, 10L = &quot;</span> &lt;&lt; val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
</div><!-- fragment --><p>Similarly, isce3::io::Raster::setValue can be used to set a pixel value.</p>
<div class="fragment"><div class="line"><span class="comment">//Create a Float32 raster of 100 pixels by 200 lines</span></div>
<div class="line">isce3::io::Raster raster(<span class="stringliteral">&quot;test.tif&quot;</span>, 100, 200,1, GDT_Float32, <span class="stringliteral">&quot;GTiff&quot;</span>); </div>
<div class="line"></div>
<div class="line"><span class="comment">//Set value in Band 1</span></div>
<div class="line"><span class="keywordtype">int</span> val = 25;</div>
<div class="line">raster.setValue(val, 5,10);</div>
</div><!-- fragment --><h1><a class="anchor" id="rasterline"></a>
Reading/Writing Single line</h1>
<p>ISCE Raster object can currently interact with 3 types of containers - a raw buffer (no size checks), std::vector and std::valarray. One can use any of the 3 interfaces with the isce3::io::Raster::getLine and isce3::io::Raster::setLine methods.</p>
<div class="fragment"><div class="line"><span class="comment">//Create a Float32 raster of 100 pixels by 200 lines</span></div>
<div class="line">isce3::io::Raster raster(<span class="stringliteral">&quot;test.vrt&quot;</span>, 100, 200);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Create a vector and valarray for reading</span></div>
<div class="line">std::vector&lt;float&gt; input(100);</div>
<div class="line">std::valarray&lt;double&gt; output(200);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0; ii&lt;100; ii++)</div>
<div class="line">    input[ii] = ii * 2.0;</div>
<div class="line"></div>
<div class="line"><span class="comment">//Set line number 10</span></div>
<div class="line">raster.setLine(input, 10);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Read line number 10</span></div>
<div class="line">raster.getLine(output, 10);</div>
</div><!-- fragment --><h1><a class="anchor" id="rasterblock"></a>
Reading/Writing Single block</h1>
<p>Like single line I/O, one can use any of the 3 interfaces (pointer, vector, valarray) with the isce3::io::Raster::getBlock and isce3::io::Raster::setBlock methods. Note that all data is read in from or to a contiguous bufferin row major order. Currently, there is no interface to read/write from a blocked interface. If one wishes to do this see the section on advanced usage below to work with the GDAL Dataset pointer directly.</p>
<div class="fragment"><div class="line"><span class="comment">//Create a Float32 raster of 100 pixels by 200 lines</span></div>
<div class="line">isce3::io::Raster raster(<span class="stringliteral">&quot;test.vrt&quot;</span>, 100, 200);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Create a vector and valarray for reading</span></div>
<div class="line"><span class="comment">//Assuming a block of 5 x 5</span></div>
<div class="line">std::vector&lt;float&gt; input(25);</div>
<div class="line">std::valarray&lt;double&gt; output(25);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0; ii&lt;25; ii++)</div>
<div class="line">    input[ii] = ii * 2.0;</div>
<div class="line"></div>
<div class="line"><span class="comment">//Set block of 5x5 with top left at (2,3)</span></div>
<div class="line">raster.setBlock(input, 2, 3, 5, 5);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Read the block we just wrote</span></div>
<div class="line">raster.getBlock(output, 2, 3, 5, 5);</div>
</div><!-- fragment --><h1><a class="anchor" id="rasteradvanced"></a>
Advanced usage - direct access to GDAL dataset</h1>
<p>ISCE Raster class is a thin wrapper over GDAL's <a href="https://www.gdal.org/classGDALDataset.html">GDALDataset</a> class. One can access the underlying pointer using the isce3::io::Raster::dataset method. </p>
</div></div><!-- contents -->
<hr>
Generated for ISCE3.0 by
<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.5.
</body>
</html>
